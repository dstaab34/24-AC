STARTING FROM ESXi TO CREATE A VM FOR EACH ELASTIC NODE. REPEAT THE STEPS FOUR MORE TIMES TO CREATE YOUR CLUSTER

1. On the Virtual Machines tab, click "Create/Register VM"
2. Select "Create a new virtual machine", then click next
3. Enter in the name "Splunk - .50, leave the compatibility tab default. 
4. Select Guest OS Family as "Linux"
5. Select Guest OS Version as "CentOS 7 (64-bit)", then click next
6. Select "VIRTUAL_MACHINE_DATASTORE". DO NOT SELECT ANY OTHER DATASTORE TO STORE ANY VIRTUAL MACHINE ON
7. Select next, then under customize settings in the "Virtual Hardware" Tab, click "Add network adapter" twice.
8. Ensure the configuration matches the following(if not specified, leave the defaults):
  - CPU: 64
  - Memory: 128B
  - Hard disk 1: 4TB
  - Click the arrow next to "Hard disk 1" and make sure "Thin Provisioning" is checked. THIS IS CRUCIAL
  - Network Adapter 1: VM Network
  - When you get to CD/DVD Drive one, select "Datastore ISO File", then navigate to TOOLS_DATASTORE > ISO and click on the CentOS 7 DVD image.
9. Click next, verify your presets, then click finish.
10. Click on the Elastic VM, then click the play button to open up a window of the Elastic Virtual Machine

NEXT, We will boot it and configure it.
1. Select "Test this media & Install CentOS 7) and hit enter
2. At the Installation Menu, select English (United States) and click continue
3. At software selection, select "Server with GUI"
4. At installation destination, ensure "VMWare Virtual disk" is selected, as well as "Automatically configure partitioning"
5. At network and Hostname, change hostname to "splunkenterprise.kitX" where 'X' is kit number (e.g. splunkenterprise.kit3). then click apply.
6. still in network and hostname, select ens192 and click configure
7. Under the General tab, check "Automatically connect to this network when it is available"
8. Under IPv4 settings, change method to manual, and assign the address as follows:
  - Address: 10.1.X.50 where 'X' is the kit subnet.(e.g. 10.1.6.50)
  - Netmask: 255.255.0.0
  - Gateway: 10.1.X.1 where 'X' is the kit subnet (e.g. 10.1.6.1)
9. Click save, ensure ens192 is connected and on, then click done.
10. Click begin installation. set root password and create a user. User should be given admin privileges
11. After installation, click reboot
12. After reboot, accept license information, then click finish configuration
13. At the initial set up, leave defaults on first two screens, turn off location services and skip connecting online accounts. 

NEXT, we will connect a repository and download CentOS packages and Elastic. 
1. From infrastructure laptop, open up WinSCP and open a connection to the device you are configuring with 'gucci' credentials. Drag and drop localrepo.repos from desktop directory on infrastructure laptop into the home directory of the Elastic VM, then close out the WinSCP Connection
2. Back in the VM, switch to super user (sudo su). IN the next few steps, run the commands as they appear in the steps
3. ping 10.1.7.30 (to ensure connectivity to the repository)
4. cd /etc
5. mkdir yum.repos.old
6. mv yum.repos.d/* yum.repos.old/
7. mv /home/gucci/localrepo.repo yum.repos.d/
8. ls yum.repos.old (to verify the old repos moved over)
9. ls yum.repos.d (to verify the only thing in there is localrepo.repo)
10. yum-config-manager --save --setopt=local-kit.skip_if_unavailable=true
11. yum repo-pkgs local-base install --skip-broken (if prompted, press 'y')
12. yum repo-pkgs local-extras install --skip-broken (if prompted, press 'y')
13. yum repo-pkgs local-updates install --skip-broken (if prompted, press 'y')
14. yum repo-pkgs local-centosplus install --skip-broken (if prompted, press 'y')

**Run the following commands in a terminal after using Winscp to transfer over the splunkcpt tgz from the infrax laptop. **
mkdir /opt/splunk 
cd /opt/splunk
tar -xvf <splunk cpt package>
cd /opt/splunk/bin
./splunk start
*when prompted, enter the user as admin and the password as Br111ckSquad!!!*
cd ../etc/apps
cd /opt/
adduser spunk
chown -R splunk:splunk splunk

navigate to 'http://10.1.x.50:8000' where 'x' is the kit subnet number
log in and click on apps > manage apps > Upload apps
Upload apps from the files you've been using to install all TA's and apps on the Splunk Sensor. 
Select settings > advanced search > search macros > search all macros under "Created by" for the apt falconer app. make sure each index exists. save and restart splunk searchhead

